library(dplyr)

# Traits kept in end
h1 <- data.table::fread("/oak/stanford/groups/pritch/users/courtrun/hla_ukbb/genotype_data/hb1_heatmapplotted.txt")
h2 <- data.table::fread("/oak/stanford/groups/pritch/users/courtrun/hla_ukbb/genotype_data/hb2_heatmapplotted.txt",fill=TRUE)
h3 <- data.table::fread("/oak/stanford/groups/pritch/users/courtrun/hla_ukbb/genotype_data/hb3_heatmapplotted.txt",fill=TRUE)
h <- unique(c(h1$traits,h2$traits,h3$traits))

# Traits that had at least one sig association with haplotypes
trait_annotations <- data.frame(traits=c("HC703", "BIN_FC10006152", "BIN_FC5006152", "HC310", "HC990", "BIN_FC20020549", "HC1345", "HC151", "HC810", "HC528", "HC530", "HC170", "HC639", "BIN22133", "HC1201", "BIN21068", "BIN_FC6006149", "HC55", "HC645", "HC1132", "HC303", "HC1212", "HC430", "HC1242", "HC422", "BIN_FC9006154", "BIN_FC2006154", "BIN_FC8006154", "HC1188", "BIN_FC1006149", "HC1102", "HC201", "BIN10030820", "HC38", "BIN_FC10002986", "HC219", "HC643","HC1021", "HC49", "HC85", "FH1044", "HC1094", "HC1322", "BIN_FC9006152", "HC1581", "HC382", "BIN_FC4006152", "HC1036", "BIN_FC3006153", "BIN_FC8006153", "HC648", "BIN_FC3006177", "BIN_FC6006177", "FH1220", "BIN2443", "HC221", "HC652", "BIN23067", "BIN2188", "BIN_FC4001747", "HC1233", "HC352", "HC125", "HC607", "HC497", "BIN2473", "HC620", "HC868", "HC1209", "HC26", "cancer1003", "cancer1060", "HC646", "HC332", "BIN_FC10001707", "HC1159", "HC1213", "HC91","HC321", "HC185", "HC1158", "BIN23069", "HC900", "cancer1041", "HC853", "BIN22127", "BIN2453", "BIN1950", "FH1065", "HC215", "HC700", "BIN_FC1006153", "BIN_FC6006153", "BIN23066", "HC337", "HC96", "HC156", "HC1024", "HC78", "HC136", "BIN_FC10002492", "HC1236", "BIN2316", "HC1211"),Plot=c("Mineral metabolism disorder","Rhinitis/eczema","Rhinitis/eczema 2","Hiatal hernia","Varicose veins","Anxiety Rx","Vulvovaginitis","MS","MS 2","HSV infection","VZV infection","Sarcoidosis","Sarcoidosis 2","Sarcoidosis 3","SLE","Celiac disease","Dentures","Hyperthyroid thyrotoxicosis","Hyperthyroid thyrotoxicosis 2","Malabsorption","Celiac disease 2","Rheumatoid arthritis 2","Rheumatoid arthritis","Ankylosing spondylitis 2","Ankylosing spondylitis", "Paracetamol use","Ibuprofen use","Ibuprofen use 2","Vitiligo","Mouth ulcers","UC 2","UC","Elevated rheumatoid factor","Psoriasis","Insulin","Hypothyroidism","Hypothyroidism 2","Allergic rhinitis","Allergic rhinitis 2","Enlarged prostate","Prostate cancer","Inguinal hernia","Enlarged prostate 2","Asthma","Asthma 2","Asthma 3","Asthma 4","Asthma 5","Diabetes Rx (F)","Insulin 2","Diabetes 5","Diabetes Rx (M)","Insulin 3","Diabetes 1","Diabetes 2","Diabetes 3","Diabetes 4","MCV seropositivity","Chronic illness","Brown hair","SLE 2","SLE 3","Anemia","Anemia 2","STI","Other serious disability","Anemia 3","Iridocyclitis","Reactive arthropathies","Iritis","Skin cancer","Non-melanoma skin cancer","Thyroiditis","PTSD","Right handedness","Psoriasis 2","Psoriatic arthropathies","Psoriatic arthropathy 2","Sjogren's","Cellulitis","Dermatitis","HPV18 seropositivity","Otitis externa","Cervical cancer","Stye","Asthma 6","Cancer","Sensitivity","Hypertension 2","Hypertension","Lipidemia","Cholesterol Rx (F)","Cholesterol Rx","JCV seropositivity","Type 1 Diabetes","Polymyalgia rheumatica","Nasal polyps","Nasal polyps 2","Arthritis","Connective tissue disorder","Other Rx","Connective tissue disorder 2","Wheezing","Seropositive RA"))

# all traits
phe_full <- data.table::fread("/oak/stanford/groups/mrivas/ukbb24983/phenotypedata/master_phe/master.phe.info.tsv")

# all traits tested for haplotypes (binary)
t <- data.table::fread("/oak/stanford/groups/pritch/users/courtrun/hla_ukbb/genotype_data/hb1_afterregalldiseases.txt")

keep <- filter(phe_full,`#GBE_ID` %in% h)
tested <- filter(phe_full,`#GBE_ID` %in% unique(t$trait)) %>% filter(N>400)


traits <- c("HSV-1_seropositivity_for_Herpes_Simplex_virus-1", "HSV-2_seropositivity_for_Herpes_Simplex_virus-2", "VZV_seropositivity_for_Varicella_Zoster_Virus", "EBV_seropositivity_for_Epstein-Barr_Virus", "CMV_seropositivity_for_Human_Cytomegalovirus", "HHV-6_overall_seropositivity_for_Human_Herpesvirus-6", "HHV-6A_seropositivity_for_Human_Herpesvirus-6", "HHV-6B_seropositivity_for_Human_Herpesvirus-6", "HHV-7_seropositivity_for_Human_Herpesvirus-7", "KSHV_seropositivity_for_Kaposi's_Sarcoma-Associated_Herpesvirus", "T._gondii_seropositivity_for_Toxoplasma_gondii", "BKV_seropositivity_for_Human_Polyomavirus_BKV", "JCV_seropositivity_for_Human_Polyomavirus_JCV", "MCV_seropositivity_for_Merkel_Cell_Polyomavirus", "HPV_16_Definition_I_seropositivity_for_Human_Papillomavirus_type-16", "C._trachomatis_Definition_I_seropositivity_for_Chlamydia_trachomatis", "H._pylori_Definition_I_seropositivity_for_Helicobacter_pylori", "H._pylori_Definition_II_seropositivity_for_Helicobacter_pylori", "HPV_16_Definition_II_seropositivity_for_Human_Papillomavirus_type-16", "Probable_recurrent_major_depression_(severe)", "Ever_diagnosed_with_IBS", "Vascular/heart_problems_diagnosed_by_doctor_Heart_attack", "Mouth_ulcers", "Eye_problems/disorders_Macular_degeneration", "prostatitis", "brain_abscess/intracranial_abscess", "raynaud's_phenomenon/disease", "dupuytren's_contracture", "endometriosis", "pneumothorax", "parkinsons_disease", "bursitis", "pulmonary_embolism_+/-_dvt", "hyperparathyroidism", "gastric/stomach_ulcers", "labyrinthitis", "ureteric_obstruction/hydronephrosis", "cholelithiasis/gall_stones", "cellulitis", "osteopenia", "aortic_aneurysm_rupture", "non-infective_hepatitis", "hypothyroidism/myxoedema", "osteoporosis", "interstitial_lung_disease", "rubella_/_german_measles", "cholecystitis", "herpes_simplex", "mrsa_/_methicillin_resistant_staphylococcus_aureus", "allergy_or_anaphylactic_reaction_to_food", "heart_valve_problem/heart_murmur", "abnormal_smear_(cervix)", "pericarditis", "meniere's_disease", "schizophrenia", "inguinal_hernia", "cataract", "uterine_polyps", "eczema/dermatitis", "bronchiectasis", "peripheral_neuropathy", "whooping_cough_/_pertussis", "cystitis", "polycystic_ovaries/polycystic_ovarian_syndrome", "vasculitis", "carpal_tunnel_syndrome", "chronic_sinusitis", "colitis/not_crohns_or_ulcerative_colitis", "measles_/_morbillivirus", "primary_biliary_cirrhosis", "gout", "tonsiltis", "giant_cell/temporal_arteritis", "fibromyalgia", "blepharitis_/_eyelid_infection", "sick_sinus_syndrome", "bell's_palsy/facial_nerve_palsy", "psoriasis", "peripheral_vascular_disease", "bph_/_benign_prostatic_hypertrophy", "osteoarthritis", "kidney_stone/ureter_stone/bladder_stone", "lichen_planus", "helicobacter_pylori", "pancreatitis", "trigemminal_neuralgia", "nephritis", "polio_/_poliomyelitis", "spinal_stenosis", "varicose_veins", "transient_ischaemic_attack_(tia)", "tendonitis_/_tendinitis_/_tenosynovitis", "cardiomyopathy", "sclerosing_cholangitis", "ovarian_cyst_or_cysts", "hiv/aids", "emphysema", "hepatitis", "emphysema", "thyroiditis", "oesophagitis/barretts_oesophagus", "eye/eyelid_problem", "disorder_of_adrenal_gland", "chronic_fatigue_syndrome", "pulmonary_fibrosis", "lung_cancer", "breast_cancer", "stomach_cancer", "tongue_cancer", "rectal_cancer", "larynx/throat_cancer", "colon_cancer/sigmoid_cancer", "liver/hepatocellular_cancer", "pancreas_cancer")

moretraits <- c("Doctor_diagnosed_bronchiectasis", "Doctor_diagnosed_tuberculosis", "emphysema/chronic_bronchitis_diagnosed_by_doctor", "DVT_diagnosed_by_doctor", "kidney/renal_cell_cancer", "bladder_cancer", "female_genital_tract_cancer", "male_genital_tract_cancer", "ovarian_cancer", "uterine/endometrial_cancer", "cervical_cancer", "prostate_cancer", "testicular_cancer", "lymphoma", "leukaemia", "multiple_myeloma", "hodgkins_lymphoma_/_hodgkins_disease", "non-hodgkins_lymphoma", "chronic_lymphocytic", "cerebral_palsy","polycystic_kidney","chronic_myeloid", "malignant_melanoma", "non-melanoma_skin_cancer", "thyroid_cancer", "acute_myeloid_leukaemia", "respiratory_/_intrathoracic_cancer", "bone_metastases_/_bony_secondaries", "Doctor_diagnosed_hayfever_or_allergic_rhinitis", "Doctor_diagnosed_asthma", "Doctor_diagnosed_chronic_bronchitis", "Doctor_diagnosed_sarcoidosis")

alltraits <- setdiff(unique(c(keep$GBE_NAME,traits,moretraits)),"Cholesterol_lowering_medication")  # combine and remove redunant
alltraits_df <- phe_full %>% filter(GBE_NAME %in% alltraits | `#GBE_ID`=="BIN_FC6006153") %>% # combine and remove redunant
              select(`#GBE_ID`,GBE_NAME,FIELD,N) %>% rename(trait_ID=`#GBE_ID`)

data.table::fwrite(alltraits_df,"/oak/stanford/groups/pritch/users/courtrun/hla_ukbb/genotype_data/traits_tested_ukbb.txt", row.names = F, quote = F, sep = ",")
